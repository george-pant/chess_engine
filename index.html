<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>ENGINE</title>
  <meta name="description" content="ENGINE">
  <meta name="author" content="ENGINE">

  <link rel="stylesheet" href="style.css?v=1.0">

  <script
  src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
  integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
  crossorigin="anonymous"></script>
 
  <script src="main.js"></script>

</head>

<body>
  <script src="main.js"></script>
</body>

<div class="chessboard">
    <!-- 1st -->
    <div class="square white" data-square="98"></div>
    <div class="square black" data-square="97"></div>
    <div class="square white" data-square="96"></div>
    <div class="square black" data-square="95"></div>
    <div class="square white" data-square="94"></div>
    <div class="square black" data-square="93"></div>
    <div class="square white" data-square="92"></div>
    <div class="square black" data-square="91"></div>
    <!-- 2nd -->
    <div class="square black" data-square="88"></div>
    <div class="square white" data-square="87"></div>
    <div class="square black" data-square="86"></div>
    <div class="square white" data-square="85"></div>
    <div class="square black" data-square="84"></div>
    <div class="square white" data-square="83"></div>
    <div class="square black" data-square="82"></div>
    <div class="square white" data-square="81"></div>
    <!-- 3th -->
    <div class="square white" data-square="78"></div>
    <div class="square black" data-square="77"></div>
    <div class="square white" data-square="76"></div>
    <div class="square black" data-square="75"></div>
    <div class="square white" data-square="74"></div>
    <div class="square black" data-square="73"></div>
    <div class="square white" data-square="72"></div>
    <div class="square black" data-square="71"></div>
    <!-- 4st -->
    <div class="square black" data-square="68"></div>
    <div class="square white" data-square="67"></div>
    <div class="square black" data-square="66"></div>
    <div class="square white" data-square="65"></div>
    <div class="square black" data-square="64"></div>
    <div class="square white" data-square="63"></div>
    <div class="square black" data-square="62"></div>
    <div class="square white" data-square="61"></div>
    <!-- 5th -->
    <div class="square white" data-square="58"></div>
    <div class="square black" data-square="57"></div>
    <div class="square white" data-square="56"></div>
    <div class="square black" data-square="55"></div>
    <div class="square white" data-square="54"></div>
    <div class="square black" data-square="53"></div>
    <div class="square white" data-square="52"></div>
    <div class="square black" data-square="51"></div>
    <!-- 6th -->
    <div class="square black" data-square="48"></div>
    <div class="square white" data-square="47"></div>
    <div class="square black" data-square="46"></div>
    <div class="square white" data-square="45"></div>
    <div class="square black" data-square="44"></div>
    <div class="square white" data-square="43"></div>
    <div class="square black" data-square="42"></div>
    <div class="square white" data-square="41"></div>
    <!-- 7th -->
    <div class="square white" data-square="38"></div>
    <div class="square black" data-square="37"></div>
    <div class="square white" data-square="36"></div>
    <div class="square black" data-square="35"></div>
    <div class="square white" data-square="34"></div>
    <div class="square black" data-square="33"></div>
    <div class="square white" data-square="32"></div>
    <div class="square black" data-square="31"></div>
    <!-- 8th -->
    <div class="square black" data-square="28"></div>
    <div class="square white" data-square="27"></div>
    <div class="square black" data-square="26"></div>
    <div class="square white" data-square="25"></div>
    <div class="square black" data-square="24"></div>
    <div class="square white" data-square="23"></div>
    <div class="square black" data-square="22"></div>
    <div class="square white" data-square="21"></div>
    </div>


    <script>
    
    function update_board(board){
            
            $(".chessboard div").removeClass("active inactive target");

            for(var i=0;i<board.length;i++){

                if(board[i]!=1){

                    piece='';
                    piece_color='';
                    board[i]+='';

                    if(board[i]=='p') piece='&#9817;';
                    if(board[i]=='P') piece='&#9823;';
                    if(board[i]=='k') piece='&#9812;';
                    if(board[i]=='K') piece='&#9818;';
                    if(board[i]=='q') piece='&#9813;';
                    if(board[i]=='Q') piece='&#9819;';
                    if(board[i]=='b') piece='&#9815;';
                    if(board[i]=='B') piece='&#9821;';
                    if(board[i]=='n') piece='&#9816;';
                    if(board[i]=='N') piece='&#9822;';
                    if(board[i]=='r') piece='&#9814;';
                    if(board[i]=='R') piece='&#9820;';

                    if(board[i].charCodeAt() >= 65 && board[i].charCodeAt() <= 90){
                        piece_color=1;
                    }else if(board[i].charCodeAt() >= 92 && board[i].charCodeAt() <= 122){
                        piece_color=0;
                    }

                    $('*[data-square="'+i+'"]').html(piece);
                    $('*[data-square="'+i+'"]').data('piece-color',piece_color);


                }
            }

        }

    $(document).ready(function(){

        console.log(board);

        $(".chessboard div").click(function(){
            
            var clicked_square=$(this).data('square');
            var piece_color=$(this).data('piece-color');
            var valid_piece_moves=board.valid_moves[board.moving_player][clicked_square];

            //if we click an already clicked square we unselect it
            if($(this).hasClass('active') || $(this).hasClass('inactive') ){
                $(".chessboard div").removeClass('active inactive target');
                return;
            }
            
            // of if its a target square we make the move
            if($(this).hasClass('target')){

            var from=$(".chessboard div.active").data('square');
            var to=$(this).data('square');

            board.move(from,to);
            update_board(board.position);

            return;

            }

            //we click a new square so we clear the board 

            $(".chessboard div").removeClass('active inactive target');
            
            if( [0,1].includes(piece_color) && board.moving_player===piece_color && typeof board.valid_moves[board.moving_player][clicked_square]!=='undefined' ){

            for(var i=0;i<valid_piece_moves.length;i++){

                $(this).addClass('active');

                $('*[data-square="'+board.valid_moves[board.moving_player][clicked_square][i]+'"]').addClass('target');

                }
            

            }else{
            
            $(this).addClass('inactive');

            }

            
        });

        update_board(board.position);

    });

    </script>

</html>