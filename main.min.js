if("undefined"==typeof window)var{performance:performance}=require("perf_hooks");var squares=[],piece={P:100,N:300,B:300,R:500,Q:900,K:6e4},directions=[];directions.P=[[-10,-20],[-9],[-11]],directions.p=[[10,20],[9],[11]],directions.B=directions.b=[[-11,-22,-33,-44,-55,-66,-77],[-9,-18,-27,-36,-45,-54,-63],[11,22,33,44,55,66,77],[9,18,27,36,45,54,63]],directions.R=directions.r=[[-1,-2,-3,-4,-5,-6,-7],[-10,-20,-30,-40,-50,-60,-70],[1,2,3,4,5,6,7],[10,20,30,40,50,60,70]],directions.N=directions.n=[[-21],[-19],[-12],[-8],[8],[12],[19],[21]],directions.Q=directions.q=directions.r.concat(directions.b),directions.K=directions.k=[[-11],[-10],[-9],[-1,-2],[1],[9],[10],[11],[1,2]],directions.check=directions.q.concat(directions.n);var history=[];const starting_position=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,"r","n","b","k","q","b","n","r",1,1,"p","p","p","p","p","p","p","p",1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,"P","P","P","P","P","P","P","P",1,1,"R","N","B","K","Q","B","N","R",1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];var board={game_status:2,moving_player:0,moves:[],temp_moves:[],valid_moves:[]};board.valid_moves[0]=[],board.valid_moves[1]=[],board.position=[],board.history=[],board.castling_rights=[[!0,!0],[!0,!0]],board.initialize=function(){this.game_status=2,this.moving_player=0,this.moves=[],this.valid_moves=[],this.position=starting_position.concat(),this.history=[],this.castling_rights=[],this.castling_rights[0]=[!0,!0],this.castling_rights[1]=[!0,!0],this.find_valid_moves()},board.move=function(i,t){return this.moving_player=this.moves.length%2==0||0==this.moves.length?0:1,this.valid_moves[this.moving_player][i].includes(t)?(this.history.push({position:this.position.slice(),castling_rights:this.castling_rights.slice(),moves:this.moves.slice()}),this.position[parseInt(t)]=this.position[i],this.position[i]=0,"string"==typeof t&&(this.position[parseInt(t)]=t[t.length-1]),24===i&&22===t&&!0===this.castling_rights[0][0]&&(this.position[23]="r",this.position[21]=0),24===i&&26===t&&!0===this.castling_rights[0][0]&&(this.position[25]="r",this.position[28]=0),94===i&&92===t&&!0===this.castling_rights[1][0]&&(this.position[93]="R",this.position[91]=0),94===i&&96===t&&!0===this.castling_rights[1][0]&&(this.position[95]="R",this.position[98]=0),24===i&&this.castling_rights[0].indexOf(!0)>-1?this.castling_rights[0]=[!1,!1]:21!==i&&21!==t||!0!==board.castling_rights[0][0]?28!==i&&28!==t||!0!==board.castling_rights[0][1]||(this.castling_rights[0][1]=!1):this.castling_rights[0][0]=!1,94===i&&this.castling_rights[1].indexOf(!0)>-1?this.castling_rights[1]=[!1,!1]:91!==i&&91!==t||!0!==board.castling_rights[1][0]?98!==i&&98!==t||!0!==board.castling_rights[1][1]||(this.castling_rights[1][1]=!1):this.castling_rights[1][0]=!1,this.moves.push([i,t]),this.moving_player=1-this.moving_player,this.find_valid_moves(),0===this.valid_moves[this.moving_player].length&&(king_square=0==this.moving_player?this.position.indexOf("k"):this.position.indexOf("K"),this.game_status=this.attacked_square(king_square,1-this.moving_player)?1-this.moving_player:3),!0):(console.log("invalid move from "+i+" to "+t),board.print(),board.status(),!1)},board.undo_move=function(){if(!(this.history.length>0))return!1;var i=this.history.pop();this.position=i.position.concat(),this.castling_rights=i.castling_rights,this.moves=i.moves.concat(),2==this.game_status?this.moving_player=1-this.moving_player:this.game_status=2,this.find_valid_moves()},board.move_random=function(){var i=Object.keys(this.valid_moves[this.moving_player]),t=i[Math.floor(i.length*Math.random())],s=this.valid_moves[this.moving_player][t][Math.floor(this.valid_moves[this.moving_player][t].length*Math.random())],o=parseInt(t),e=s;return!!this.move(o,e)},board.find_piece_color=function(i){return 0==this.position[i]||1==this.position[i]||void 0===this.position[i]?2:this.position[i].charCodeAt(0)>=65&&this.position[i].charCodeAt(0)<=90?1:0},board.attacked_square=function(i,t){for(var s=1-t,o=0;o<directions.check.length;o++)for(var e=0;e<directions.check[o].length;e++)if(attack_check=i+directions.check[o][e],0!=this.position[attack_check]){if(1==this.position[attack_check])break;if(attacking_piece_color=this.find_piece_color(attack_check),s===attacking_piece_color)break;if(("P"===this.position[i+9]||"P"===this.position[i+11])&&0===s||("p"===this.position[i-9]||"p"===this.position[i-11])&&1===s||o<4&&(0===s&&"R"===this.position[attack_check]||1===s&&"r"===this.position[attack_check])||o>3&&o<8&&(0===s&&"B"===this.position[attack_check]||1===s&&"b"===this.position[attack_check])||o<8&&(0===s&&"Q"===this.position[attack_check]||1===s&&"q"===this.position[attack_check])||o>7&&(0===s&&"N"===this.position[attack_check]||1===s&&"n"===this.position[attack_check])||o<8&&0===e&&("K"===this.position[attack_check]&&0===s||"k"===this.position[attack_check]&&1===s))return!0;break}return!1},board.find_valid_moves=function(){this.valid_moves[0]=[],this.valid_moves[1]=[];for(var i=21;i<92;i+=10)for(var t=0;t<8;t++){var s=i+t;if(0!=this.position[s]){var o=this.position[s],e=this.find_piece_color(s);if(e==this.moving_player)for(var a=0;a<directions[o].length;a++)for(var r=0;r<directions[o][a].length&&(target_square=parseInt(s)+parseInt(directions[o][a][r]),1!=this.position[target_square])&&(target_piece_color=this.find_piece_color(target_square),e!==target_piece_color);r++){if("p"===o||"P"===o){if((s-target_square)%10!=0&&0==this.position[target_square])continue;if((s-target_square)%10==0&&0!=this.position[target_square])break;if(("p"===o&&s>40||"P"===o&&s<81)&&20===Math.abs(directions[o][a][r]))break;"p"===o&&target_square>90&&(target_square+="q"),"P"===o&&target_square<29&&(target_square+="Q")}if("k"===o||"K"===o){if(-2==directions[o][a][r]&&(!0!==this.castling_rights[e][0]||0!=this.position[target_square]||this.attacked_square(s,1-this.moving_player)||this.attacked_square(s-1,1-this.moving_player)))break;if(2==directions[o][a][r]&&(!0!==this.castling_rights[e][1]||0!=this.position[target_square-1]||0!=this.position[target_square]||0!=this.position[target_square+1]||this.attacked_square(s,1-this.moving_player)||this.attacked_square(s+1,1-this.moving_player)))break}var n=this.position[parseInt(target_square)];this.position[parseInt(target_square)]=this.position[s],this.position[s]=0;var h=0==this.moving_player?this.position.indexOf("k"):this.position.indexOf("K"),c=this.attacked_square(h,1-this.moving_player);if(this.position[s]=this.position[parseInt(target_square)],this.position[parseInt(target_square)]=n,c||(this.valid_moves[e][s]=this.valid_moves[e][s]||[]).push(target_square),2!=target_piece_color)break}}}},board.initialize();for(var i=0,t0=performance.now();i<2e4;)board.move_random(),i++,2==board.game_status&&i%50!=0||board.initialize();var t1=performance.now(),moves_per_sec=i/((t1-t0)/1e3);console.log(moves_per_sec.toFixed(2)+" moves/second.");